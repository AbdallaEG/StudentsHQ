import React, { useState, useRef, useEffect } from "react";
import { Link } from "react-router-dom";
import Dropdown from "../utils/Dropdown";

function Header() {
  const [mobileNavOpen, setMobileNavOpen] = useState(false);

  const mobileNav = useRef(null);

  // close the mobile menu on click outside
  useEffect(() => {
    const clickHandler = ({ target }) => {
      if (!mobileNavOpen || mobileNav.current.contains(target)) return;
      setMobileNavOpen(false);
    };
    document.addEventListener("click", clickHandler);
    return () => document.removeEventListener("click", clickHandler);
  });

  // close the mobile menu if the esc key is pressed
  useEffect(() => {
    const keyHandler = ({ keyCode }) => {
      if (!mobileNavOpen || keyCode !== 27) return;
      setMobileNavOpen(false);
    };
    document.addEventListener("keydown", keyHandler);
    return () => document.removeEventListener("keydown", keyHandler);
  });

  return (
    <header className="absolute w-full z-30">
      <div className="max-w-6xl mx-auto px-4 sm:px-6">
        <div className="flex items-center justify-between h-20">
          {/* Site branding */}
          <div className="flex-shrink-0 ">
            {/* Logo */}
            <Link to="/" className="block pb-0.5" aria-label="Cruip">
              <svg
                width="170"
                height="35"
                viewBox="0 0 170 35"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <circle cx="17.9688" cy="17.5" r="17.5" fill="#070707" />
                <path
                  d="M35.4163 16.1339C33.8462 14.5083 32.2569 12.9015 30.6486 11.3137C26.6444 7.36531 22.5188 3.48031 18.1558 0C19.943 0.0185938 21.6667 0.30625 23.2877 0.821406C27.1016 4.22734 30.7755 7.81922 34.4035 11.4712C34.9427 12.9434 35.2905 14.5075 35.4163 16.1328V16.1339ZM33.8981 24.7559C31.1681 21.9155 28.3736 19.1559 25.4358 16.5845C21.3824 13.0342 13.7403 5.85484 8.22455 8.47109C3.2458 10.8314 3.06533 20.0025 2.79955 26.2314C1.26802 23.5767 0.464035 20.5648 0.468771 17.5C0.468771 10.7177 4.32752 4.83547 9.96908 1.93156C11.9597 2.58016 13.8989 3.76359 15.4794 4.76109C22.6642 9.28922 28.9216 15.3814 34.9394 21.7908C34.6802 22.8189 34.3302 23.8098 33.8981 24.7559ZM28.9708 31.1106C28.6072 30.8063 28.24 30.5063 27.8694 30.2105C25.0541 27.9639 21.2117 24.955 17.5947 25.7873C14.2894 26.5475 12.931 30.4544 12.1588 34.0123C10.741 33.5134 9.3936 32.8333 8.15018 31.9889C8.55049 28.443 9.12362 24.6881 10.7806 21.747C13.3127 17.255 17.6571 18.387 21.2949 20.5089C24.9699 22.6527 28.3135 25.5095 31.481 28.6212C30.7298 29.5328 29.8889 30.3664 28.9708 31.1095V31.1106Z"
                  fill="#5D5DFF"
                />
                <path
                  d="M49.6685 23.9623C48.9965 23.9623 48.3305 23.8783 47.6705 23.7103C47.0105 23.5422 46.4465 23.3082 45.9785 23.0082L46.0865 20.4162H47.4725L47.8325 22.5942C48.1085 22.7142 48.3905 22.8102 48.6785 22.8822C48.9665 22.9422 49.2905 22.9722 49.6505 22.9722C50.3945 22.9722 50.9765 22.7982 51.3965 22.4502C51.8285 22.0902 52.0445 21.6162 52.0445 21.0282C52.0445 20.5002 51.8945 20.0862 51.5945 19.7862C51.2945 19.4862 50.8145 19.2042 50.1545 18.9402L49.4165 18.6342C48.4325 18.2142 47.6465 17.7102 47.0585 17.1222C46.4825 16.5342 46.1945 15.7662 46.1945 14.8182C46.1945 14.1102 46.3745 13.5042 46.7345 13.0002C47.0945 12.4842 47.5925 12.0942 48.2285 11.8302C48.8765 11.5542 49.6205 11.4162 50.4605 11.4162C51.0845 11.4162 51.6665 11.5002 52.2065 11.6682C52.7465 11.8362 53.2205 12.0642 53.6285 12.3522L53.5025 14.7822H52.1345L51.7745 12.6942C51.3545 12.5022 50.9045 12.4062 50.4245 12.4062C49.8245 12.4062 49.3145 12.5682 48.8945 12.8922C48.4745 13.2042 48.2645 13.6542 48.2645 14.2422C48.2645 14.7582 48.4265 15.1782 48.7505 15.5022C49.0745 15.8262 49.5305 16.1082 50.1185 16.3482L50.8925 16.6722C52.0685 17.1642 52.9025 17.6922 53.3945 18.2562C53.8985 18.8202 54.1505 19.5462 54.1505 20.4342C54.1505 21.4902 53.7485 22.3422 52.9445 22.9902C52.1525 23.6383 51.0605 23.9623 49.6685 23.9623ZM58.4093 23.9083C57.6893 23.9083 57.1253 23.7283 56.7173 23.3682C56.3093 23.0082 56.1053 22.4322 56.1053 21.6402C56.1053 21.3642 56.1053 21.1062 56.1053 20.8662C56.1173 20.6142 56.1233 20.3142 56.1233 19.9662V16.1322H54.7913V15.1962L56.2493 15.0162L56.9333 12.5502H58.3913L58.3193 15.0342H60.4793V16.1322H58.3013V21.4422C58.3013 21.8862 58.3853 22.2102 58.5533 22.4142C58.7333 22.6182 58.9673 22.7202 59.2553 22.7202C59.5793 22.7202 59.9453 22.5702 60.3533 22.2702L60.7853 22.7202C60.5573 23.0922 60.2453 23.3862 59.8493 23.6022C59.4533 23.8063 58.9733 23.9083 58.4093 23.9083ZM67.8218 23.8183L67.6778 22.2342C66.8018 23.3502 65.7818 23.9083 64.6178 23.9083C63.8738 23.9083 63.2738 23.6683 62.8178 23.1882C62.3738 22.6962 62.1578 21.8562 62.1698 20.6682L62.2418 16.2222L61.0718 15.9702V15.2682L64.2218 14.8902L64.4378 15.0882L64.3478 17.6082V20.5962C64.3478 21.2682 64.4498 21.7422 64.6538 22.0182C64.8698 22.2822 65.1758 22.4142 65.5718 22.4142C65.9078 22.4142 66.2498 22.3182 66.5978 22.1262C66.9578 21.9342 67.2998 21.6882 67.6238 21.3882L67.6778 16.2222L66.5438 15.9702V15.3042L69.6218 14.8902L69.8558 15.0882L69.8018 17.6082V22.6842L70.8998 22.9182V23.6562L67.8218 23.8183ZM74.2454 19.3902C74.2454 20.4822 74.4494 21.2982 74.8574 21.8382C75.2774 22.3662 75.8054 22.6302 76.4414 22.6302C76.7534 22.6302 77.0354 22.5702 77.2874 22.4502C77.5514 22.3182 77.7974 22.1322 78.0254 21.8922V16.7262C77.4974 16.2702 76.9754 16.0422 76.4594 16.0422C75.8594 16.0422 75.3374 16.3122 74.8934 16.8522C74.4614 17.3922 74.2454 18.2382 74.2454 19.3902ZM78.2414 23.8543L78.0974 22.7202C77.7614 23.1042 77.3894 23.3982 76.9814 23.6022C76.5734 23.8063 76.1054 23.9083 75.5774 23.9083C74.8694 23.9083 74.2394 23.7283 73.6874 23.3682C73.1474 23.0082 72.7214 22.4922 72.4094 21.8202C72.0974 21.1482 71.9414 20.3502 71.9414 19.4262C71.9414 18.4782 72.1154 17.6562 72.4634 16.9602C72.8234 16.2642 73.2974 15.7302 73.8854 15.3582C74.4854 14.9742 75.1394 14.7822 75.8474 14.7822C76.3034 14.7822 76.7114 14.8662 77.0714 15.0342C77.4434 15.2022 77.7914 15.4782 78.1154 15.8622V12.1542L76.7114 11.9742V11.2722L80.0054 10.4622L80.2754 10.6242L80.2034 13.1622V22.7202L81.3734 22.9182V23.6562L78.2414 23.8543ZM86.6308 15.6462C86.3428 15.6462 86.0548 15.7422 85.7668 15.9342C85.4908 16.1142 85.2508 16.4142 85.0468 16.8342C84.8548 17.2542 84.7348 17.8242 84.6868 18.5442H87.1528C87.5848 18.5442 87.8728 18.4542 88.0168 18.2742C88.1608 18.0942 88.2328 17.8422 88.2328 17.5182C88.2328 16.9662 88.0768 16.5162 87.7648 16.1682C87.4528 15.8202 87.0748 15.6462 86.6308 15.6462ZM86.6308 23.9083C85.7908 23.9083 85.0528 23.7283 84.4168 23.3682C83.7808 23.0082 83.2828 22.4922 82.9228 21.8202C82.5628 21.1362 82.3828 20.3262 82.3828 19.3902C82.3828 18.4302 82.5868 17.6082 82.9948 16.9242C83.4148 16.2282 83.9548 15.7002 84.6148 15.3402C85.2868 14.9682 86.0008 14.7822 86.7568 14.7822C87.4648 14.7822 88.0828 14.9322 88.6108 15.2322C89.1388 15.5322 89.5468 15.9522 89.8348 16.4922C90.1348 17.0322 90.2848 17.6682 90.2848 18.4002C90.2848 18.7842 90.2488 19.1142 90.1768 19.3902H84.6688C84.7168 20.4222 84.9868 21.1962 85.4788 21.7122C85.9828 22.2282 86.6128 22.4862 87.3688 22.4862C87.8968 22.4862 88.3408 22.3842 88.7008 22.1802C89.0728 21.9642 89.4088 21.6882 89.7088 21.3522L90.2308 21.8202C89.8828 22.4802 89.4028 22.9962 88.7908 23.3682C88.1908 23.7283 87.4708 23.9083 86.6308 23.9083ZM91.5925 23.6562V22.9182L92.7625 22.6842C92.7745 22.2402 92.7805 21.7602 92.7805 21.2442C92.7805 20.7162 92.7805 20.2602 92.7805 19.8762V18.9222C92.7805 18.4302 92.7745 18.0402 92.7625 17.7522C92.7625 17.4522 92.7505 17.1222 92.7265 16.7622L91.4665 16.6002V15.9162L94.4725 14.7822L94.7605 14.9622L94.8865 16.3482C95.8105 15.3042 96.8305 14.7822 97.9465 14.7822C98.7265 14.7822 99.3265 15.0402 99.7465 15.5562C100.178 16.0722 100.394 16.8882 100.394 18.0042V19.8762C100.394 20.2842 100.394 20.7462 100.394 21.2622C100.394 21.7782 100.4 22.2582 100.412 22.7022L101.51 22.9182V23.6562H97.0645V22.9182L98.2165 22.6842C98.2285 22.2402 98.2345 21.7662 98.2345 21.2622C98.2345 20.7462 98.2345 20.2842 98.2345 19.8762V18.1662C98.2345 17.4582 98.1385 16.9722 97.9465 16.7082C97.7545 16.4322 97.4305 16.2942 96.9745 16.2942C96.3385 16.2942 95.6665 16.5882 94.9585 17.1762V19.8762C94.9585 20.2722 94.9585 20.7282 94.9585 21.2442C94.9585 21.7602 94.9645 22.2462 94.9765 22.7022L96.0385 22.9182V23.6562H91.5925ZM105.694 23.9083C104.974 23.9083 104.41 23.7283 104.002 23.3682C103.594 23.0082 103.39 22.4322 103.39 21.6402C103.39 21.3642 103.39 21.1062 103.39 20.8662C103.402 20.6142 103.408 20.3142 103.408 19.9662V16.1322H102.076V15.1962L103.534 15.0162L104.218 12.5502H105.676L105.604 15.0342H107.764V16.1322H105.586V21.4422C105.586 21.8862 105.67 22.2102 105.838 22.4142C106.018 22.6182 106.252 22.7202 106.54 22.7202C106.864 22.7202 107.23 22.5702 107.638 22.2702L108.07 22.7202C107.842 23.0922 107.53 23.3862 107.134 23.6022C106.738 23.8063 106.258 23.9083 105.694 23.9083ZM111.738 23.9083C111.186 23.9083 110.676 23.8423 110.208 23.7103C109.752 23.5902 109.296 23.4042 108.84 23.1522L108.822 21.0642H110.028L110.352 22.7382C110.784 22.9182 111.252 23.0082 111.756 23.0082C112.368 23.0082 112.824 22.9002 113.124 22.6842C113.424 22.4682 113.574 22.1682 113.574 21.7842C113.574 21.4482 113.454 21.1782 113.214 20.9742C112.974 20.7582 112.566 20.5542 111.99 20.3622L111.09 20.0562C110.418 19.8402 109.884 19.5222 109.488 19.1022C109.104 18.6822 108.912 18.1542 108.912 17.5182C108.912 17.0142 109.044 16.5582 109.308 16.1502C109.572 15.7302 109.956 15.4002 110.46 15.1602C110.976 14.9082 111.6 14.7822 112.332 14.7822C112.848 14.7822 113.316 14.8482 113.736 14.9802C114.168 15.1002 114.594 15.2802 115.014 15.5202L114.924 17.4102H113.736L113.412 15.8982C113.076 15.7542 112.704 15.6822 112.296 15.6822C111.816 15.6822 111.444 15.7842 111.18 15.9882C110.916 16.1922 110.784 16.4682 110.784 16.8162C110.784 17.1402 110.892 17.4042 111.108 17.6082C111.336 17.8002 111.756 17.9982 112.368 18.2022L113.088 18.4182C113.964 18.7182 114.588 19.0902 114.96 19.5342C115.332 19.9782 115.518 20.5122 115.518 21.1362C115.518 21.9402 115.188 22.6062 114.528 23.1342C113.88 23.6502 112.95 23.9083 111.738 23.9083ZM123.756 12.5682V11.7222H129.12V12.5682L127.626 12.7302C127.614 13.4742 127.602 14.2302 127.59 14.9982C127.59 15.7542 127.59 16.5222 127.59 17.3022V18.0762C127.59 18.8322 127.59 19.5942 127.59 20.3622C127.602 21.1182 127.614 21.8802 127.626 22.6482L129.12 22.8102V23.6562H123.756V22.8102L125.214 22.6482C125.238 21.8922 125.25 21.1242 125.25 20.3442C125.25 19.5642 125.25 18.7842 125.25 18.0042H120.372C120.372 18.8682 120.372 19.6782 120.372 20.4342C120.384 21.1902 120.396 21.9282 120.408 22.6482L121.884 22.8102V23.6562H116.52V22.8102L118.014 22.6482C118.038 21.9042 118.05 21.1482 118.05 20.3802C118.05 19.6122 118.05 18.8442 118.05 18.0762V17.3022C118.05 16.5462 118.05 15.7902 118.05 15.0342C118.05 14.2662 118.038 13.4982 118.014 12.7302L116.52 12.5682V11.7222H121.884V12.5682L120.408 12.7302C120.396 13.4742 120.384 14.2182 120.372 14.9622C120.372 15.7062 120.372 16.4082 120.372 17.0682H125.25C125.25 16.3242 125.25 15.5922 125.25 14.8722C125.25 14.1522 125.238 13.4382 125.214 12.7302L123.756 12.5682ZM136.482 23.8183L136.338 22.2342C135.462 23.3502 134.442 23.9083 133.278 23.9083C132.534 23.9083 131.934 23.6683 131.478 23.1882C131.034 22.6962 130.818 21.8562 130.83 20.6682L130.902 16.2222L129.732 15.9702V15.2682L132.882 14.8902L133.098 15.0882L133.008 17.6082V20.5962C133.008 21.2682 133.11 21.7422 133.314 22.0182C133.53 22.2822 133.836 22.4142 134.232 22.4142C134.568 22.4142 134.91 22.3182 135.258 22.1262C135.618 21.9342 135.96 21.6882 136.284 21.3882L136.338 16.2222L135.204 15.9702V15.3042L138.282 14.8902L138.516 15.0882L138.462 17.6082V22.6842L139.56 22.9182V23.6562L136.482 23.8183ZM140.563 23.6562V22.9182L141.733 22.7022C141.745 22.2582 141.751 21.7782 141.751 21.2622C141.763 20.7342 141.769 20.2722 141.769 19.8762V12.1362L140.455 11.9742V11.2722L143.677 10.4622L143.947 10.6242L143.875 13.1622V16.0602C144.679 15.2082 145.573 14.7822 146.557 14.7822C147.205 14.7822 147.793 14.9562 148.321 15.3042C148.849 15.6522 149.263 16.1622 149.563 16.8342C149.875 17.4942 150.031 18.3042 150.031 19.2642C150.031 20.2122 149.857 21.0342 149.509 21.7302C149.173 22.4262 148.723 22.9662 148.159 23.3502C147.595 23.7222 146.965 23.9083 146.269 23.9083C145.801 23.9083 145.363 23.8183 144.955 23.6382C144.559 23.4582 144.187 23.1582 143.839 22.7382L143.605 23.8723L140.563 23.6562ZM145.693 16.0602C145.417 16.0602 145.129 16.1322 144.829 16.2762C144.541 16.4202 144.241 16.6242 143.929 16.8882V21.8742C144.481 22.3902 145.045 22.6482 145.621 22.6482C146.209 22.6482 146.707 22.3782 147.115 21.8382C147.523 21.2982 147.727 20.4762 147.727 19.3722C147.727 18.2562 147.535 17.4282 147.151 16.8882C146.779 16.3362 146.293 16.0602 145.693 16.0602Z"
                  fill="#C5D2DC"
                />
              </svg>
            </Link>
          </div>

          {/* Desktop navigation */}
          <nav className="hidden md:flex md:flex-grow">
            {/* Desktop menu links */}
            <ul className="flex flex-grow justify-end flex-wrap items-center ">
              <li>
                <Link
                  to="/features"
                  className="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out"
                >
                  Tjenester
                </Link>
              </li>
              <li>
                <Link
                  to="/pricing"
                  className="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out"
                >
                  Pris
                </Link>
              </li>
              <li>
                <Link
                  to="/blog"
                  className="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out"
                >
                  Blog
                </Link>
              </li>
              <li>
                <Link
                  to="/about"
                  className="text-gray-300 hover:text-gray-200 px-4 py-2 flex items-center transition duration-150 ease-in-out"
                >
                  Om oss
                </Link>
              </li>
              {/* 1st level: hover */}
              <Dropdown title="Support">
                {/* 2nd level: hover */}
                <li>
                  <Link
                    to="/contact"
                    className="font-medium text-sm text-gray-400 hover:text-purple-600 flex py-2 px-4 leading-tight"
                  >
                    Kontakt
                  </Link>
                </li>
                <li>
                  <Link
                    to="/help"
                    className="font-medium text-sm text-gray-400 hover:text-purple-600 flex py-2 px-4 leading-tight"
                  >
                    FAQ
                  </Link>
                </li>
                <li>
                  <Link
                    to="/404"
                    className="font-medium text-sm text-gray-400 hover:text-purple-600 flex py-2 px-4 leading-tight"
                  >
                    404
                  </Link>
                </li>
              </Dropdown>
            </ul>

            {/* Desktop sign in links */}
            <ul className="flex flex-grow justify-end flex-wrap items-center">
              <li>
                <Link
                  to="/signin"
                  className="font-medium text-purple-600 hover:text-gray-200 px-4 py-3 flex items-center transition duration-150 ease-in-out"
                >
                  Sign in
                </Link>
              </li>
              <li>
                <Link
                  to="/signup"
                  className="btn-sm text-white bg-purple-600 hover:bg-purple-700 ml-3"
                >
                  Sign up
                </Link>
              </li>
            </ul>
          </nav>

          {/* Mobile menu */}
          <div className="md:hidden">
            {/* Hamburger button */}
            <button
              className={`hamburger ${mobileNavOpen && "active"}`}
              aria-controls="mobile-nav"
              aria-expanded={mobileNavOpen}
              onClick={() => setMobileNavOpen(!mobileNavOpen)}
            >
              <span className="sr-only">Menu</span>
              <svg
                className="w-6 h-6 fill-current text-gray-300 hover:text-gray-200 transition duration-150 ease-in-out"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect y="4" width="24" height="2" rx="1" />
                <rect y="11" width="24" height="2" rx="1" />
                <rect y="18" width="24" height="2" rx="1" />
              </svg>
            </button>

            {/*Mobile navigation */}
            <nav
              id="mobile-nav"
              ref={mobileNav}
              className="absolute top-full z-20 left-0 w-full px-4 sm:px-6 overflow-hidden transition-all duration-300 ease-in-out"
              style={
                mobileNavOpen
                  ? { maxHeight: mobileNav.current.scrollHeight, opacity: 1 }
                  : { maxHeight: 0, opacity: 0.8 }
              }
            >
              <ul className="bg-gray-800 px-4 py-2">
                <li>
                  <Link
                    to="/features"
                    className="flex text-gray-300 hover:text-gray-200 py-2"
                  >
                    Features
                  </Link>
                </li>
                <li>
                  <Link
                    to="/pricing"
                    className="flex text-gray-300 hover:text-gray-200 py-2"
                  >
                    Pricing
                  </Link>
                </li>
                <li>
                  <Link
                    to="/blog"
                    className="flex text-gray-300 hover:text-gray-200 py-2"
                  >
                    Blog
                  </Link>
                </li>
                <li>
                  <Link
                    to="/about"
                    className="flex text-gray-300 hover:text-gray-200 py-2"
                  >
                    About us
                  </Link>
                </li>
                <li className="py-2 my-2 border-t border-b border-gray-700">
                  <span className="flex text-gray-300 py-2">Support</span>
                  <ul className="pl-4">
                    <li>
                      <Link
                        to="/contact"
                        className="text-sm flex font-medium text-gray-400 hover:text-gray-200 py-2"
                      >
                        Contact us
                      </Link>
                    </li>
                    <li>
                      <Link
                        to="/help"
                        className="text-sm flex font-medium text-gray-400 hover:text-gray-200 py-2"
                      >
                        Help center
                      </Link>
                    </li>
                    <li>
                      <Link
                        to="/404"
                        className="text-sm flex font-medium text-gray-400 hover:text-gray-200 py-2"
                      >
                        404
                      </Link>
                    </li>
                  </ul>
                </li>
                <li>
                  <Link
                    to="/signin"
                    className="flex font-medium w-full text-purple-600 hover:text-gray-200 py-2 justify-center"
                  >
                    Sign in
                  </Link>
                </li>
                <li>
                  <Link
                    to="/signup"
                    className="font-medium w-full inline-flex items-center justify-center border border-transparent px-4 py-2 my-2 rounded-sm text-white bg-purple-600 hover:bg-purple-700 transition duration-150 ease-in-out"
                  >
                    Sign up
                  </Link>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </header>
  );
}

export default Header;
